
<van-nav-bar bind_init="_initComponent" z-index="99" fixed="{{true}}" border="{{false}}" title="{{transpNav ? '' : '商品详情'}}" customClass="{{transpNav ? 'trans-nav' : ''}}" left-arrow="{{true}}" data-wpy-evt="36-0" bindclickLeft="_proxy"></van-nav-bar>
<view class="container">
  <swiper wx:if="{{ goods.goodsImages.length > 0 }}" autoplay="{{true}}" circular="{{true}}" skip-hidden-item-layout indicator-active-color="rgba(255,255,255,.7)" indicator-dots="{{goods.goodsImages.length > 1 ? true : false}}" easing-function="easeOutCubic" interval="{{5000}}" duration="{{1000}}" class="swiper-banner">
    <swiper-item wx:for="{{ goods.goodsImages }}" wx:for-index="index" wx:for-item="img" wx:key="index" data-wpy-evt="36-1" bindtap="_proxy" data-wpytap-a="{{ index }}" class="slide-image">
      <image src="{{img}}" mode="aspectFill" class="slide-image"></image>
    </swiper-item>
  </swiper>
  <view style="margin-bottom: {{isIPhoneX ? 160 : 120}}rpx;" class="content">
    <view class="countDownBox">
      <view class="priceBox">
        <text>¥<text class="price">{{goods.groupPrice}}</text></text>
        <text class="price-discount">¥{{goods.goodsPrice}}</text>
      </view>
      <view class="hasSaled">
        <text class="saled">已拼{{goods.salesNum}}件</text>
        <view class="countDown">
          <van-icon bind_init="_initComponent" name="clock-o" size="18" color="#FC401C"></van-icon>
          <van-count-down bind_init="_initComponent" time="{{ goods.endTime * 1000 - nowTime }}" format="DD天HH时mm分ss秒"></van-count-down>
        </view>
      </view>
    </view>
    <view class="titleBox">
      <view style="flex-direction: column;flex:1;">
        <view class="title">
          <image src="/images/goods/hour_arrive.png" alt mode="aspectFit" class="hourArrive"></image>
          {{goods.groupName}}
        </view>
        <view class="goodsDesc">{{goods.groupContent}}</view>
        <view class="groupNum">
          <view class="item num">{{goods.groupNum}}人团</view>
          <view class="item start">{{goods.saleStartNum}}件起购</view>
        </view>
      </view>
      <button open-type="share" class="share">
        <van-icon bind_init="_initComponent" name="share" size="20px" color="#8a8a8a"></van-icon>
        <text style="color: #8a8a8a;">分享</text>
      </button>
    </view>
    <view class="cellGroup">
      <van-cell bind_init="_initComponent" title="送至" value="{{currentArea.title}}" customClass="vanCell" titleClass="vanCellTitle" valueClass="vanCellValue" is-link="{{true}}" link-type="navigateTo" url="/pages/other/location"></van-cell>
      <van-cell bind_init="_initComponent" title="配送" customClass="vanCell" titleClass="vanCellTitle">
        <view class="vanCellValueCustom">
          <text>由{{storeInfo.storeName}}销售和发货</text>
          <view style="align-items: center;padding-top: 10rpx;">
            <text>商品包邮</text>
            <text style="color: #fc8825;padding-left:10rpx;">拼团成功后48内发货</text>
          </view>
        </view>
      </van-cell>
    </view>
    <view class="cellGroup">
      <van-cell bind_init="_initComponent" title="促销" customClass="vanCell" titleClass="vanCellTitle">
        <view class="vanCellValueCustom">
          <view class="ac">
            <view class="discount">返积分</view>
            <text style="margin-left:10rpx;font-size: 24rpx;">购物最高返15积分</text>
          </view>
        </view>
      </van-cell>
    </view>
    <view class="cellGroup">
      <van-cell bind_init="_initComponent" title="数量" customClass="vanCell" titleClass="vanCellTitle">
        <van-stepper bind_init="_initComponent" value="{{ goodsNum }}" disable-input="{{true}}" async-change="{{true}}" custom-class="stepper" plus-class="circleBtn plusBtn" minus-class="circleBtn" input-class="inputBox" data-wpy-evt="36-2" bindminus="_proxy" bindplus="_proxy"></van-stepper>
      </van-cell>
      <van-cell bind_init="_initComponent" title="服务" customClass="vanCell" titleClass="vanCellTitle">
        <view style="flex-wrap: wrap;" class="ac">
          <view class="serverItem">
            <van-icon bind_init="_initComponent" name="passed" color="#595959" size="16px"></van-icon>
            <view style="padding-left:6rpx;">正品保障</view>
          </view>
          <view class="serverItem">
            <van-icon bind_init="_initComponent" name="passed" color="#595959" size="16px"></van-icon>
            <view style="padding-left:6rpx;">质量无忧</view>
          </view>
          <view class="serverItem">
            <van-icon bind_init="_initComponent" name="passed" color="#595959" size="16px"></van-icon>
            <view style="padding-left:6rpx;">店铺销售&发货</view>
          </view>
          <view class="serverItem">
            <van-icon bind_init="_initComponent" name="passed" color="#595959" size="16px"></van-icon>
            <view style="padding-left:6rpx;">商品包邮</view>
          </view>
          <view class="serverItem">
            <van-icon bind_init="_initComponent" name="passed" color="#595959" size="16px"></van-icon>
            <view style="padding-left:6rpx;">48小时发货</view>
          </view>
        </view>
      </van-cell>
    </view>
    <view class="cellGroup">
      <van-cell bind_init="_initComponent" wx:if="{{ goods.attrType === 'multiple' }}" title="选择" value="请选择商品规格" customClass="vanCell ac" titleClass="vanCellTitle" valueClass="vanCellValue" data-wpy-evt="36-4" bindtap="_proxy">
        <van-icon bind_init="_initComponent" slot="right-icon" name="arrow" color="#999999"></van-icon>
      </van-cell>
      <van-cell bind_init="_initComponent" title="参数" value="查看商品详细参数" customClass="vanCell ac" titleClass="vanCellTitle" valueClass="vanCellValue" data-wpy-evt="36-5" bindtap="_proxy">
        <van-icon bind_init="_initComponent" slot="right-icon" name="arrow" color="#999999"></van-icon>
      </van-cell>
    </view>
    <view wx:if="{{ groupOrders.length > 0 }}" class="joinBox">
      <text style="padding: 24rpx 0;">马上买？可直接参与下面的团</text>
      <view wx:for="{{ groupOrders }}" wx:for-index="key" wx:for-item="order" wx:key="key" class="joinUser">
        <image src="{{ order.createrAvatar || '/images/shop/shop_logo.png' }}" alt class="avatar"></image>
        <view class="leftTime">
          <text>{{order.createrNickname}}</text>
          <view class="ac">
            <text style="padding-right: 10rpx;">距结束还剩</text>
            <van-count-down bind_init="_initComponent" time="{{ order.endTime * 1000 - nowTime }}" format="HH:mm:ss"></van-count-down>
          </view>
        </view>
        <view>
          还差<text style="color: #f23030;">{{order.groupNum - order.joinNum}}</text>人成团
        </view>
        <view data-wpy-evt="36-6" bindtap="_proxy" data-wpytap-a="{{ order }}" class="joinGroup">
          立即参团
        </view>
      </view>
    </view>
    <view class="shopInfo">
      <image src="{{storeInfo.logoUrl || '/images/shop/shop_logo.png'}}" alt class="shopLogo"></image>
      <view class="shopBox">
        <view style="justify-content: space-between;" class="ac">
          <view class="shopProvider ellipsis">{{storeInfo.shortName}}</view>
          <view data-wpy-evt="36-7" bindtap="_proxy" class="shopAbout goInto">
            <text>进店</text>
          </view>
        </view>
        <view class="ac">
          <view data-wpy-evt="36-8" bindtap="_proxy" class="shopAbout">
            <van-icon bind_init="_initComponent" name="phone-o" color="#696969" size="16px"></van-icon>
            <text style="margin-left:10rpx;">联系商家</text>
          </view>
          <view data-wpy-evt="36-9" bindtap="_proxy" class="shopAbout">
            <van-icon bind_init="_initComponent" name="info-o" color="#696969" size="16px"></van-icon>
            <text style="margin-left:10rpx;">店铺信息</text>
          </view>
        </view>
      </view>
    </view>
    <view class="description">
      —————<label class="words">商品详情</label>—————
    </view>
    <rich-text nodes="{{goods.goodsDescription}}"></rich-text>
  </view>
</view>

<view style="{{isIPhoneX ? 'height: 160rpx;' : ''}};" class="submitAction">
  <view data-wpy-evt="36-10" bindtap="_proxy" class="cartIcon">
    <van-icon bind_init="_initComponent" name="shopping-cart" color="#ffffff" size="28px"></van-icon>
  </view>
  <view>
    <van-button bind_init="_initComponent" type="warning" custom-class="purchaseBtn addCart" data-wpy-evt="36-11" bindtap="_proxy">
      <view class="startGroup">
        <text class="groupPrice">¥<text style="font-size:28rpx;">38</text></text>
        <text class="groupPrice">单独购买</text>
      </view>
    </van-button>
    <van-button bind_init="_initComponent" type="warning" custom-class="purchaseBtn settle" data-wpy-evt="36-12" bindtap="_proxy">
      <view class="startGroup">
        <text class="groupPrice">¥<text style="font-size:28rpx;">28</text></text>
        <text class="groupPrice">我要开团</text>
      </view>
    </van-button>
  </view>
</view>
<van-popup bind_init="_initComponent" show="{{ isShowShopInfoModal }}" position="bottom" customClass="vanPopup" safe-area-inset-bottom="{{false}}" data-wpy-evt="36-13" bindclose="_proxy">
  <view data-wpy-evt="36-14" catchtouchmove="_proxy" class="attributeBox">
    <view class="title">店铺信息</view>
    <view class="attribute">
      <view class="content">
        <view class="shopName">{{storeInfo.storeName}}</view>
        <view class="ac serveInfo">
          <view class="shopServe">送达时间</view>
          <view class="serveContent">{{storeInfo.bizHours}}</view>
        </view>
        <view class="ac serveInfo">
          <view class="shopServe">配送服务</view>
          <view class="serveContent">达达快送</view>
        </view>
        <view class="ac serveInfo">
          <view class="shopServe">门店地址</view>
          <view class="serveContent">{{storeInfo.address}}（<text data-wpy-evt="36-15" bindtap="_proxy" style="color: #3388ff;">去这里</text>）</view>
        </view>
        <map id="map" scale="18" longitude="{{storeInfo.lng}}" latitude="{{storeInfo.lat}}" enable-zoom="{{true}}" show-location="{{true}}" markers="{{markers}}" polyline="{{polyline}}" data-wpy-evt="36-16" bindmarkertap="_proxy" bindregionchange="_proxy" style="width: 100%; height: 250px;margin-top:40rpx;"></map>
      </view>
    </view>
  </view>
</van-popup>
<van-popup bind_init="_initComponent" show="{{ isShowExplainModal }}" position="bottom" customClass="vanPopup" safe-area-inset-bottom="{{false}}" data-wpy-evt="36-18" bindclose="_proxy">
  <view data-wpy-evt="36-19" catchtouchmove="_proxy" class="attributeBox">
    <view class="title">运费说明</view>
    <view class="attribute">
      <view class="content">
        目前在全国范围内有七个始发仓库，
        配送范围包括：上海、北京、广东、江苏、浙江、安徽、天津、河北、重庆、湖北、四川、福建、山东等地区，
        西藏、新疆等偏远地区可能会额外收取一些配送费用，
        详情请咨询客服人员。
      </view>
    </view>
  </view>
</van-popup>
<van-popup bind_init="_initComponent" wx:if="{{ goods.attrType === 'multiple' }}" show="{{ isShowChooseModal }}" position="bottom" customClass="vanPopup" safe-area-inset-bottom="{{false}}" data-wpy-evt="36-20" bindclose="_proxy">
  <view data-wpy-evt="36-21" catchtouchmove="_proxy" class="attributeBox">
    <view class="header">
      <image src="{{selectedAttr.imgUrl ? selectedAttr.imgUrl : goods.goodsCoverUrl}}" alt mode="aspectFill" class="img"></image>
      <view class="info">
        <view class="price">¥{{selectedAttr.salePrice ? selectedAttr.salePrice : goods.salePrice}}</view>
        <view>库存{{selectedAttr.stockNum ? selectedAttr.stockNum : goods.stockNum}}件</view>
        <view style="color: #333333;">已选： {{hasSelected}}</view>
      </view>
    </view>
    <scroll-view scroll-y="{{true}}" style="padding: 20rpx;box-sizing: border-box;max-height:{{screenHeight*0.52}}px;">
      <view wx:for="{{ goods.goodsAttrs }}" wx:for-index="n" wx:for-item="attr" wx:key="n" class="attribute">
        <view class="attrName">{{attr.attrName}}</view>
        <view class="attrItems">
          <view wx:for="{{ attr.attrValues }}" wx:for-index="index" wx:for-item="attrVal" wx:key="index" data-wpy-evt="36-22" bindtap="_proxy" data-wpytap-a="{{ attrVal }}" data-wpytap-b="{{ n }}" data-wpytap-c="{{ index }}" class="attrItem {{[attrVal.isShow ? '' : 'attrDisable' , subIndex[n] == index ? 'attrActive' : '' ]}}">
            {{attrVal.name}}
          </view>
        </view>
      </view>
    </scroll-view>
    <view style="margin-bottom:200rpx;" class="purchase">
      <text>商品数量</text>
      <van-stepper bind_init="_initComponent" value="{{ goodsNum }}" disable-input="{{true}}" plus-class="circleBtn bgLinear" minus-class="circleBtn minusBtn" input-class="inputBox" data-wpy-evt="36-23" bindminus="_proxy" bindplus="_proxy"></van-stepper>
    </view>
    <view class="finishBox">
      <view data-wpy-evt="36-25" bindtap="_proxy" class="finishBtn bgLinear white">
        我要开团
      </view>
    </view>
  </view>
</van-popup>
<van-popup bind_init="_initComponent" show="{{ isShowAttrModal }}" position="bottom" customClass="vanPopup" safe-area-inset-bottom="{{false}}" data-wpy-evt="36-26" bindclose="_proxy">
  <view data-wpy-evt="36-27" catchtouchmove="_proxy" class="attributeBox">
    <view class="title">基本参数</view>
    <scroll-view scroll-y="{{true}}" style="margin-bottom:200rpx;max-height:{{screenHeight*0.52}}px;">
      <van-cell bind_init="_initComponent" title="品牌" value="leysen1855/莱绅通灵" customClass="vanCell cellParam" titleClass="vanCellTitle minWidth120" valueClass="vanCellValue"></van-cell>
      <van-cell bind_init="_initComponent" title="售后服务" value="其他" customClass="vanCell cellParam" titleClass="vanCellTitle minWidth120" valueClass="vanCellValue"></van-cell>
      <van-cell bind_init="_initComponent" title="上市时间" value="2019年夏季" customClass="vanCell cellParam" titleClass="vanCellTitle minWidth120" valueClass="vanCellValue"></van-cell>
    </scroll-view>
    <view class="finishBox">
      <view data-wpy-evt="36-28" bindtap="_proxy" class="finishBtn bgLinear white">确定</view>
    </view>
  </view>
</van-popup>
